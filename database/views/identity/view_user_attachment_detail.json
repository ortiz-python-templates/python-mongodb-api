{
  "viewOn": "user_attachments",
  "pipeline": [
    {
      "$lookup": {
        "from": "users",
        "localField": "user_id",
        "foreignField": "_id",
        "as": "user"
      }
    },
    { "$unwind": { "path": "$user", "preserveNullAndEmptyArrays": true }},
    {
      "$project": {
        "_id": 0,
        "id": "$unique_id",
        "user_id": "$user.unique_id",
        "file_name": 1,
        "size": 1,
        "content_type": 1,
        "object_key": 1,
        "description": 1,
        "uploaded_at": 1,
        "is_deleted": 1,
        "user": {
            "id": "$user.unique_id",
            "email": "$user.email",
            "first_name": "$user.first_name",
            "last_name": "$user.last_name"
        }
      }
    }
  ]
}

